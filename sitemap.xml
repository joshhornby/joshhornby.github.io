---
layout: null
---
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9" xmlns:xhtml="http://www.w3.org/1999/xhtml">
  {%- comment -%}
  1. Filter to posts that have sitemap.lastmod defined
  2. Sort by that date (oldest→newest)
  3. Grab the very last (newest) one
  4. Store its date (stripped of spaces) in a global var
  {%- endcomment -%}
  {% assign posts_with_sitemap = site.posts
  | where_exp: "p", "p.sitemap and p.sitemap.lastmod" %}
  {% assign sorted_posts       = posts_with_sitemap
  | sort: "sitemap.lastmod" %}
  {% assign latest_post        = sorted_posts | last %}
  {% assign last_post_time     = latest_post.sitemap.lastmod | remove: " " %}

  {%- comment -%}
  Now {{ global_lastmod }} is available anywhere in this template,
  already formatted as YYYY-MM-DDThh:mm:ss±hh:mm (assuming your front-matter uses that format).
  {%- endcomment -%}

  <url>
    <loc>{{ site.url }}</loc>
    <lastmod>{{ last_post_time | date_to_xmlschema }}</lastmod>
  </url>
  <url>
    <loc>{{ site.url }}/about</loc>
  </url>
  {% for post in site.posts %}
    <url>
      <loc>{{ site.url }}{{ post.url }}</loc>
      {% if post.sitemap %}
        <lastmod>{{ post.sitemap.lastmod | remove: " " }}</lastmod>
      {% endif %}
    </url>
  {% endfor %}
  <url>
    <loc>{{ site.url }}/tags</loc>
    <lastmod>{{ last_post_time | date_to_xmlschema }}</lastmod>
  </url>
  {% for tag in site.tags %}
    {% assign posts_for_tag = tag[1] %}
    {% if posts_for_tag.size > 0 %}
    {% assign sorted = posts_for_tag | sort: "sitemap.lastmod" %}
    {% assign last_post = sorted | last %}

    {% comment %}
    {% endcomment %}
    {% assign git_time = last_post.path | last_modified_at %}

    <url>
      <loc>{{ site.url }}{{ site.baseurl }}/tags/{{ tag[0] | slugify }}</loc>
      <lastmod>{{ git_time | date_to_xmlschema }}</lastmod>
    </url>
    {% endif %}
  {% endfor %}
</urlset>
